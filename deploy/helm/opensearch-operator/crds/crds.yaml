---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: opensearchclusters.opensearch.stackable.tech
  annotations:
    helm.sh/resource-policy: keep
spec:
  group: opensearch.stackable.tech
  names:
    categories: []
    kind: OpenSearchCluster
    plural: opensearchclusters
    shortNames:
      - opensearch
    singular: opensearchcluster
  scope: Namespaced
  versions:
    - additionalPrinterColumns: []
      name: v1alpha1
      schema:
        openAPIV3Schema:
          description: Auto-generated derived type for OpenSearchClusterSpec via `CustomResource`
          properties:
            spec:
              description: A OpenSearch cluster stacklet. This resource is managed by the Stackable operator for OpenSearch. Find more information on how to use it and the resources that the operator generates in the [operator documentation](https://docs.stackable.tech/home/nightly/opensearch/).
              properties:
                clusterOperation:
                  default:
                    reconciliationPaused: false
                    stopped: false
                  description: '[Cluster operations](https://docs.stackable.tech/home/nightly/concepts/operations/cluster_operations) properties, allow stopping the product instance as well as pausing reconciliation.'
                  properties:
                    reconciliationPaused:
                      default: false
                      description: Flag to stop cluster reconciliation by the operator. This means that all changes in the custom resource spec are ignored until this flag is set to false or removed. The operator will however still watch the deployed resources at the time and update the custom resource status field. If applied at the same time with `stopped`, `reconciliationPaused` will take precedence over `stopped` and stop the reconciliation immediately.
                      type: boolean
                    stopped:
                      default: false
                      description: Flag to stop the cluster. This means all deployed resources (e.g. Services, StatefulSets, ConfigMaps) are kept but all deployed Pods (e.g. replicas from a StatefulSet) are scaled to 0 and therefore stopped and removed. If applied at the same time with `reconciliationPaused`, the latter will pause reconciliation and `stopped` will take no effect until `reconciliationPaused` is set to false or removed.
                      type: boolean
                  type: object
                image:
                  anyOf:
                    - required:
                        - custom
                        - productVersion
                    - required:
                        - productVersion
                  description: |-
                    Specify which image to use, the easiest way is to only configure the `productVersion`. You can also configure a custom image registry to pull from, as well as completely custom images.

                    Consult the [Product image selection documentation](https://docs.stackable.tech/home/nightly/concepts/product_image_selection) for details.
                  properties:
                    custom:
                      description: Overwrite the docker image. Specify the full docker image name, e.g. `oci.stackable.tech/sdp/superset:1.4.1-stackable2.1.0`
                      type: string
                    productVersion:
                      description: Version of the product, e.g. `1.4.1`.
                      type: string
                    pullPolicy:
                      default: Always
                      description: '[Pull policy](https://kubernetes.io/docs/concepts/containers/images/#image-pull-policy) used when pulling the image.'
                      enum:
                        - IfNotPresent
                        - Always
                        - Never
                      type: string
                    pullSecrets:
                      description: '[Image pull secrets](https://kubernetes.io/docs/concepts/containers/images/#specifying-imagepullsecrets-on-a-pod) to pull images from a private registry.'
                      items:
                        description: LocalObjectReference contains enough information to let you locate the referenced object inside the same namespace.
                        properties:
                          name:
                            description: 'Name of the referent. This field is effectively required, but due to backwards compatibility is allowed to be empty. Instances of this type with an empty value here are almost certainly wrong. More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names'
                            type: string
                        required:
                          - name
                        type: object
                      nullable: true
                      type: array
                    repo:
                      description: Name of the docker repo, e.g. `oci.stackable.tech/sdp`
                      nullable: true
                      type: string
                    stackableVersion:
                      description: Stackable version of the product, e.g. `23.4`, `23.4.1` or `0.0.0-dev`. If not specified, the operator will use its own version, e.g. `23.4.1`. When using a nightly operator or a pr version, it will use the nightly `0.0.0-dev` image.
                      nullable: true
                      type: string
                  type: object
                nodes:
                  description: OpenSearch nodes
                  properties:
                    cliOverrides:
                      additionalProperties:
                        type: string
                      default: {}
                      type: object
                    config:
                      default: {}
                      properties:
                        nodeRoles:
                          items:
                            enum:
                              - data
                              - ingest
                              - cluster_manager
                              - remote_cluster_client
                              - warm
                              - search
                            type: string
                          nullable: true
                          type: array
                      type: object
                    configOverrides:
                      additionalProperties:
                        additionalProperties:
                          type: string
                        type: object
                      default: {}
                      description: The `configOverrides` can be used to configure properties in product config files that are not exposed in the CRD. Read the [config overrides documentation](https://docs.stackable.tech/home/nightly/concepts/overrides#config-overrides) and consult the operator specific usage guide documentation for details on the available config files and settings for the specific product.
                      type: object
                    envOverrides:
                      additionalProperties:
                        type: string
                      default: {}
                      description: '`envOverrides` configure environment variables to be set in the Pods. It is a map from strings to strings - environment variables and the value to set. Read the [environment variable overrides documentation](https://docs.stackable.tech/home/nightly/concepts/overrides#env-overrides) for more information and consult the operator specific usage guide to find out about the product specific environment variables that are available.'
                      type: object
                    podOverrides:
                      default: {}
                      description: In the `podOverrides` property you can define a [PodTemplateSpec](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.27/#podtemplatespec-v1-core) to override any property that can be set on a Kubernetes Pod. Read the [Pod overrides documentation](https://docs.stackable.tech/home/nightly/concepts/overrides#pod-overrides) for more information.
                      type: object
                      x-kubernetes-preserve-unknown-fields: true
                    roleConfig:
                      default:
                        podDisruptionBudget:
                          enabled: true
                          maxUnavailable: null
                      description: This is a product-agnostic RoleConfig, which is sufficient for most of the products.
                      properties:
                        podDisruptionBudget:
                          default:
                            enabled: true
                            maxUnavailable: null
                          description: |-
                            This struct is used to configure:

                            1. If PodDisruptionBudgets are created by the operator 2. The allowed number of Pods to be unavailable (`maxUnavailable`)

                            Learn more in the [allowed Pod disruptions documentation](https://docs.stackable.tech/home/nightly/concepts/operations/pod_disruptions).
                          properties:
                            enabled:
                              default: true
                              description: Whether a PodDisruptionBudget should be written out for this role. Disabling this enables you to specify your own - custom - one. Defaults to true.
                              type: boolean
                            maxUnavailable:
                              description: The number of Pods that are allowed to be down because of voluntary disruptions. If you don't explicitly set this, the operator will use a sane default based upon knowledge about the individual product.
                              format: uint16
                              minimum: 0.0
                              nullable: true
                              type: integer
                          type: object
                      type: object
                    roleGroups:
                      additionalProperties:
                        properties:
                          cliOverrides:
                            additionalProperties:
                              type: string
                            default: {}
                            type: object
                          config:
                            default: {}
                            properties:
                              nodeRoles:
                                items:
                                  enum:
                                    - data
                                    - ingest
                                    - cluster_manager
                                    - remote_cluster_client
                                    - warm
                                    - search
                                  type: string
                                nullable: true
                                type: array
                            type: object
                          configOverrides:
                            additionalProperties:
                              additionalProperties:
                                type: string
                              type: object
                            default: {}
                            description: The `configOverrides` can be used to configure properties in product config files that are not exposed in the CRD. Read the [config overrides documentation](https://docs.stackable.tech/home/nightly/concepts/overrides#config-overrides) and consult the operator specific usage guide documentation for details on the available config files and settings for the specific product.
                            type: object
                          envOverrides:
                            additionalProperties:
                              type: string
                            default: {}
                            description: '`envOverrides` configure environment variables to be set in the Pods. It is a map from strings to strings - environment variables and the value to set. Read the [environment variable overrides documentation](https://docs.stackable.tech/home/nightly/concepts/overrides#env-overrides) for more information and consult the operator specific usage guide to find out about the product specific environment variables that are available.'
                            type: object
                          podOverrides:
                            default: {}
                            description: In the `podOverrides` property you can define a [PodTemplateSpec](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.27/#podtemplatespec-v1-core) to override any property that can be set on a Kubernetes Pod. Read the [Pod overrides documentation](https://docs.stackable.tech/home/nightly/concepts/overrides#pod-overrides) for more information.
                            type: object
                            x-kubernetes-preserve-unknown-fields: true
                          replicas:
                            format: uint16
                            minimum: 0.0
                            nullable: true
                            type: integer
                        type: object
                      type: object
                  required:
                    - roleGroups
                  type: object
              required:
                - image
                - nodes
              type: object
            status:
              nullable: true
              properties:
                conditions:
                  default: []
                  items:
                    properties:
                      lastTransitionTime:
                        description: Last time the condition transitioned from one status to another.
                        format: date-time
                        nullable: true
                        type: string
                      lastUpdateTime:
                        description: The last time this condition was updated.
                        format: date-time
                        nullable: true
                        type: string
                      message:
                        description: A human readable message indicating details about the transition.
                        nullable: true
                        type: string
                      reason:
                        description: The reason for the condition's last transition.
                        nullable: true
                        type: string
                      status:
                        description: Status of the condition, one of True, False, Unknown.
                        enum:
                          - 'True'
                          - 'False'
                          - Unknown
                        type: string
                      type:
                        description: Type of deployment condition.
                        enum:
                          - Available
                          - Degraded
                          - Progressing
                          - ReconciliationPaused
                          - Stopped
                        type: string
                    required:
                      - status
                      - type
                    type: object
                  type: array
                discoveryHash:
                  description: An opaque value that changes every time a discovery detail does
                  nullable: true
                  type: string
              type: object
          required:
            - spec
          title: OpenSearchCluster
          type: object
      served: true
      storage: true
      subresources:
        status: {}
