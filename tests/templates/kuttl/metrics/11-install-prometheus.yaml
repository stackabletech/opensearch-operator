---
apiVersion: kuttl.dev/v1beta1
kind: TestStep
commands:
  # Append the namespace to the Helm release name so that cluster-wide
  # resources get unique names.
  - script: |
      helm install prometheus-$NAMESPACE \
        --namespace $NAMESPACE \
        --version 80.14.2 \
        --values 11_kube-prometheus-stack-values.yaml \
        --wait \
        oci://ghcr.io/prometheus-community/charts/kube-prometheus-stack

      kubectl label servicemonitors.monitoring.coreos.com stackable-opensearch \
        --namespace $NAMESPACE \
        release=prometheus-$NAMESPACE
    timeout: 600
