image:
  repository: oci.stackable.tech/sdp/opensearch-dashboards
  tag: {{ test_scenario['values']['opensearch'].split(',')[0] }}-stackable{{ test_scenario['values']['release'] }}
service:
  type: NodePort
serviceAccount:
  create: false
  # Use the ServiceAccount of OpenSearch because its permissions are already configured to work on
  # OpenShift.
  name: opensearch-serviceaccount
extraEnvs:
  - name: OPENSEARCH_HOSTS
    valueFrom:
      configMapKeyRef:
        name: opensearch
        key: OPENSEARCH_HOSTS
  - name: OPENSEARCH_PASSWORD
    valueFrom:
      secretKeyRef:
        name: opensearch-credentials
        key: kibanaserver
config:
  opensearch_dashboards.yml:
    server:
      ssl:
        enabled: true
        certificate: /stackable/opensearch-dashboards/config/tls/tls.crt
        key: /stackable/opensearch-dashboards/config/tls/tls.key
    opensearch:
      username: kibanaserver
{% if test_scenario['values']['server-use-tls'] == 'true' %}
      ssl:
        verificationMode: full
        certificateAuthorities: [/stackable/opensearch-dashboards/config/tls/ca.crt]
{% endif %}
    opensearch_security:
      cookie:
        secure: true
extraVolumes:
  - name: tls
    ephemeral:
      volumeClaimTemplate:
        metadata:
          annotations:
            secrets.stackable.tech/class: tls
            secrets.stackable.tech/scope: service=opensearch-dashboards
        spec:
          storageClassName: secrets.stackable.tech
          accessModes:
            - ReadWriteOnce
          resources:
            requests:
              storage: "1"
# The Helm chart sets the volume "config" and adds a volume mount at
# /usr/share/opensearch-dashboards/config. But in the Stackable image, the configuration directory
# is located in /stackable/opensearch-dashboards/config.
extraVolumeMounts:
# The same is true for the TLS volume.
  - mountPath: /stackable/opensearch-dashboards/config/tls
    name: tls
  - mountPath: /stackable/opensearch-dashboards/config/opensearch_dashboards.yml
    name: config
    subPath: opensearch_dashboards.yml
podSecurityContext:
  fsGroup: 1000
