---
dimensions:
  - name: opensearch
    values:
      - 3.1.0
      # To use a custom image, add a comma and the full name after the product version, e.g.:
      # - 3.1.0,oci.stackable.tech/sandbox/opensearch:3.1.0-stackable0.0.0-dev
      # - 3.1.0,localhost:5000/sdp/opensearch:3.1.0-stackable0.0.0-dev
  - name: opensearch_home
    values:
      - /stackable/opensearch
  - name: http-use-tls
    values:
      - "true"
      - "false"
  # The release must sometimes be known in podOverrides or Helm values
  - name: release
    values:
      - 0.0.0-dev
tests:
  - name: smoke
    dimensions:
      - opensearch
      - opensearch_home
      - http-use-tls
  - name: external-access
    dimensions:
      - opensearch
      - opensearch_home
  # requires an image with the OpenSearch Prometheus exporter
  - name: metrics
    dimensions:
      - opensearch
  - name: ldap
    dimensions:
      - opensearch
      - opensearch_home
  # requires an image with Vector
  - name: logging
    dimensions:
      - opensearch
  - name: opensearch-dashboards
    dimensions:
      - opensearch
      - opensearch_home
      - http-use-tls
      - release
  # requires the repository-s3 plugin
  - name: snapshot-s3
    dimensions:
      - opensearch
      - release
suites:
  - name: nightly
    patch:
      - dimensions:
          - name: opensearch
            expr: last
  - name: smoke-latest
    select:
      - smoke
      - opensearch-dashboards
    patch:
      - dimensions:
          - expr: last
  - name: openshift
    patch:
      - dimensions:
          - expr: last
      - dimensions:
          - name: opensearch
            expr: last
  - name: original-image
    select:
      - smoke
      - external-access
      - ldap
      - opensearch-dashboards
    patch:
      - dimensions:
          - name: opensearch
            expr: 3.1.0,opensearchproject/opensearch:3.1.0
          - name: opensearch_home
            expr: /usr/share/opensearch
